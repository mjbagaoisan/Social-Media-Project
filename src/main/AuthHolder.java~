package main;

import java.math.BigInteger;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.util.Arrays;

public class AuthHolder implements Comparable<AuthHolder> {

    private String passwordHash;
    private String username;

    /**
     * Constructor to create an AuthHolder with username and password.
     *
     * @param password The user's plain text password.
     * @param username The user's username.
     */
    public AuthHolder(String username, String password){
        this.username = username;
        try{
            this.passwordHash = hashPassword(password);
        } catch (NoSuchAlgorithmException e) {
            System.err.println("Hashing algorithm not found: " + e.getMessage());
        }
    }


    /**
     * Generates a SHA-256 hash for the given password.
     *
     * @param password The plain text password to hash.
     * @return The hexadecimal representation of the hashed password.
     * @throws NoSuchAlgorithmException If SHA-256 algorithm is not available.
     */
    private String hashPassword(String password) throws NoSuchAlgorithmException {
        MessageDigest digest = MessageDigest.getInstance("SHA-256");
        byte[] hashBytes = digest.digest(password.getBytes());
        // Convert byte array into signum representation
        StringBuilder hexString = new StringBuilder(2 * hashBytes.length);
        for (byte b : hashBytes) {
            String hex = Integer.toHexString(0xff & b);
            if(hex.length() == 1) hexString.append('0');
            hexString.append(hex);
        }
        return hexString.toString();
        }

    /**
     * Returns the username.
     *
     * @return The username.
     */
    public String getUsername(){
        return username;
    }

    /**
     * Returns the password hash.
     * Note: Consider avoiding exposing password hashes.
     *
     * @return The password hash.
     */
    public String getPasswordHash(){
        return passwordHash;
    }

    @Override
    public int hashCode() {
        // Include both username and passwordHash in hashCode
        return Arrays.hashCode(new Object[]{username, passwordHash});
    }

    @Override
    public boolean equals(Object obj) {
        if(this == obj) {
            return true;
        }
        if (!(obj instanceof AuthHolder)) {
            return false;
        }
        AuthHolder other = (AuthHolder) obj;
        return this.username.equals(other.username) && this.passwordHash.equals(other.passwordHash);
    }

    @Override
    public int compareTo(AuthHolder other) {
        int usernameComparison = this.username.compareTo(other.username);
        if (usernameComparison != 0) {
            return usernameComparison;
        }
        return this.passwordHash.compareTo(other.passwordHash);
    }

    @Override
    public String toString() {
        return "AuthHolder{username='" + username + "'}";
    }

	
}